<style> 
  home-view {
    display: block;
    background-color: white;
  }
  search-bar {
    padding: 16px;
  }
  search-decor {
    display: block;
    border: 1px solid gray;
    border-radius: 16px;
    padding: 4px 8px;
  }
  search-decor input {
    margin-left: 8px;
    border: none;
  }
  search-decor input:focus {
    margin-left: 8px;
    border: none;
    outline: none;
  }
  [hero] {
    height: 240px;
    background-color: white;
    transition: opacity 200ms ease-in-out;
  }
  product-view {
  }
  [hero] > div {
    padding: 16px;
  }
  product-carousel {
    height: 116px;
    padding: 10px 0 20px;
    margin: 0 8px;
    font-size: 0.7em;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  product-carousel > div {
    width: 96px;
    margin: 0 12px;
  }
  product-carousel img {
    width: 100%;
  }
  action-call {
    height: 226px;
    padding: 4px 16px;
  }
  categories-view {
    color: #007dc6;
  }
  sign-up {
    padding: 16px 0;
    text-align: center;
    border-top: 1px solid #eee;
  }
  sign-up input {
    height: 22px;
    margin: 0 6px;
  }
  sign-up a {
    background-color: #ffc120 !important;
    padding: 6px 12px !important;
    border-radius: 2px;
  }
  sign-up [form] {
    padding: 4px;
    white-space: nowrap;
  }
  footer-view {
    font-size: 0.8em;
    margin-top: 16px;
    padding-bottom: 16px;
    background-color: #f2f8fd;
  }
  footer-view [footer-links] {
    text-align: center;
  }
  footer-view [footer-links] a {
    white-space: nowrap;
    padding: 8px 14px !important;
    color: #007dc6 !important;
  }
  h3 {
    margin: 8px 16px;
    font-size: 1.2em;
  }
</style>

<dom-module id="mini-view">
  <template>
    <div noflex vertical center layout>
      <img src="{{src}}">
      <span>{{price}}</span>
      <span>{{item}}</span>
    </div>
  </template>
</dom-module>

<dom-module id="home-view">

  <template>
    
    <div vertical layout>
      
      <search-bar vertical middle layout>
        <search-decor horizontal layout>
          <icon search></icon>
          <input flex>
        </search-decor>
      </search-bar>
      
      <nano-carousel hero style%="{{carouselStyle}}" vertical middle layout></nano-carousel>

      <h3>Other popular items</h3>

      <product-carousel horizontal center layout></product-carousel>

      <h3>Value of the day</h3>

      <action-call vertical middle layout>
        <product-view product="{{vod}}"></product-view>
      </action-call>

      <h3>Shop by department</h3>

      <categories-view vertical middle layout categories="{{categories}}"></categories-view>

      <footer-view vertical middle layout>
        <sign-up>
          <b>Signup and save!</b>
          <span form><input><a is="nano-anchor" title="(or be punished)">Submit!</a></span>
        </sign-up>

        <div footer-links>
          <a is="nano-anchor">Help</a>
          <a is="nano-anchor">Feedback</a>
          <a is="nano-anchor">Terms of Use</a>
          <a is="nano-anchor">Privacy and Security</a>
        </div>
      </footer-view>

    </div>

    <nano-ajax url="mart/trending.php" on-response="onTrendingResponse"></nano-ajax>
    <nano-ajax url="mart/vod.php" on-response="onVodResponse"></nano-ajax>
    <nano-ajax url="mart/taxonomy.php" on-response="onTaxonomyResponse"></nano-ajax>

  </template>

  <script>
    document.registerElement('home-view', {
      prototype: {
        __proto__: HTMLElement.prototype,
        createdCallback: function() {
          this.root = Annotations.stamp('home-view', this);
          this.root.set('carouselStyle', {opacity: 0});
        },
        onVodResponse: function(e) {
          this.root.set({vod: e.detail});
        },
        onTaxonomyResponse: function(e) {
          if (e.detail) {
            this.root.set({categories: e.detail.categories});
          }
        },
        onTrendingResponse: function(e) {
          var crsl = this.root.$('[hero]');
          crsl.textContent = '';
          if (e.detail) {
            var items = e.detail.items;
            for (var i=0; i<5; i++) {
              var pv = document.createElement('product-view');
              crsl.appendChild(document.createElement('div')).appendChild(pv);
              pv.product = items[i];
            }
            crsl.style.opacity = 1;
            crsl.start();
          }
          //
          var pc = this.root.$('product-carousel');
          pc.textContent = '';
          if (e.detail) {
            var items = e.detail.items;
            for (var i=0; i<20; i++) {
              var item = items[i + 5];
              var frag = document.createDocumentFragment();
              Annotations.stamp('mini-view', frag).set({
                price: '$' + (item.salePrice || item.msrp || (item.bestMarketplacePrice && item.bestMarketplacePrice.price)),
                name: item.name,
                src: item.thumbnailImage
              });
              pc.appendChild(frag);
            }
          }
        }
      }  
    });
  </script>
  
</dom-module>