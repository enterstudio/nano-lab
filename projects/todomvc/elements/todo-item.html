<template id="todo-item">
  <div id="static" class="view" on-dblclick="_editAction">
    <input type="checkbox" class="toggle" checked="{{item.completed}}" on-change="onCheckChange">
    <label>{{item.title}}</label>
    <button class="destroy" on-tap="_destroyAction"></button>
  </div>
  <todo-input id="edit" value="{{item.title}}"></todo-input>
  <!--<input id="edit" class="edit"
         value="{{item.title}}"
         on-td-input-commit="_commitAction"
         on-td-input-cancel="_cancelAction"
         on-blur="_onBlur">-->
</template>
<script>
  Nano({
    name: 'todo-item',
    sugar: {
      properties: ['item', 'editing'],
      template: document.currentImport.querySelector("template#todo-item")
    },
    prototype: {
      __proto__: Polymer.BaseElement.prototype,     
      itemChanged: function(item) {
        this.updateBindings('item.completed', item.completed);  
        this.updateBindings('item.title', item.title);  
        this.completedChanged(item.completed);
      },
      _onBlur: function(e) {
        this._commitAction(e);
      },
      _editAction: function() {
        this.editing = true;
        this.$.edit.focus();
      },
      onCheckChange: function() {
        this.item.completed = !this.item.completed;
        this.itemChanged(this.item);
        this.fire('todo-changed', {item: this.item});
      },
      editingChanged: function(editing) {
        //this.$.static.hidden = editing;
        this.parentElement.classList.toggle('editing', editing);
      },
      completedChanged: function(completed) {
        this.parentElement.classList.toggle('completed', completed);
      },
      _commitAction: function(e) {
        if (this.editing) {
          this.editing = false;
          if (e.target.value) {
            this.item.title = e.detail.value;
            this.itemChanged(this.item);
          } else {
            this._destroyAction();
          }
        }
      },
      _cancelAction: function() {
        this.editing = false;
      },
      _destroyAction: function() {
        this.fire('todo-destroy', {item: this.item});
      }
    }
  });
</script>
